# Go-Fvm-SDK

Convert go contract to wasm and help wasm code run on fvm

1. convert go code to wasm
2. implement fvm system call interface
3. modify library for running on fvm
4. support unit test/integration test

## Requirement

1. install [Go](https://go.dev/doc/install)  require v1.17+
2. install [Tinygo](https://tinygo.org/getting-started/install/) require v0.25+
3. install go-fvm-sdk-tools
* install from release  [go-fvm-sdk-tools](https://github.com/ipfs-force-community/go-fvm-sdk/releases) require v0.1.0
* build from source require [rust](https://www.rust-lang.org/tools/install)
  ```
  git clone git@github.com:ipfs-force-community/go-fvm-sdk.git
  make install
  ```
4. use go-fvm-sdk-tools tool to patch your environment(go/tinygo) 
  ```
    go-fvm-sdk patch
  ```

  below log meaning operate successfully
  ```log
  patching file src/reflect/value.go
  Hunk #1 succeeded at 754 (offset 3 lines).
  patching file targets/wasi.json
  patch unexpectedly ends in middle of line
  Hunk #2 succeeded at 10 with fuzz 1.
  ```

NOTICE download the latest release version from [wasm tools](https://github.com/WebAssembly/binaryen), and configure the corresponding bin path in the $PATH if log report wasm tool requirement

### Quick from template

just run ```go-fvm-sdk-tools new -- <your own actor name>``` and there will be a directory name ```<your own actor name>``` in worker directory


### Quick start hello world actor
* Compile hellocontract to Wasm
    ```
        git clone git@github.com:ipfs-force-community/go-fvm-sdk.git
        cd examples/hellocontract
        go-fvm-sdk-tools build
        go-fvm-sdk-tools test
    ```
* Set up a Lotus devnet
  * Experimental branch: experimental/fvm-m2
  * Instructions: https://lotus.filecoin.io/developers/local-network/
* Install Actor
  * lotus chain install-actor <path-to-wasm-bytecode>
* Instantiate Actor
  * lotus chain create-actor <code-cid> <encoded-params>
* Invoke actor
  * lotus chain invoke <address> <method_num> 

## Suggestion

1. Do not use asm code
2. Try not to use the reflect library, if you must use it, make sure that tinygo supports it.
3. use go list command to check actor dependency graph, check which package
    ```
    go list -json -deps > deps.json 
    ```